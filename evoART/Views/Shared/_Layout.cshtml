@using System.Web.UI.WebControls
@using evoART.Controllers
@using evoART.Models.DbModels
@using evoART.Models.ViewModels
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@ViewBag.Title</title>
    @Styles.Render("~/Content/css")
    @Scripts.Render("~/bundles/modernizr")

    <script src="@Url.Content("~/Scripts/jquery-2.1.0.js")"
            type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/jquery.unobtrusive-ajax.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/bootstrap.js")"
            type="text/javascript"></script>
    
    <script>
        var current = document.location.pathname;
        function go(a,b,c) {
            
            history.pushState({ controller: a, method: b, id: c }, b, '/' + a + '/' + b + '/' + c);
            setupPage('/' + a + '/' + b + '/' + c);
            
        }
        window.onpopstate = function (event) {
            var str = document.location.pathname;
            
            //if (str != current) {
                setupPage(str);
            //}
            return false;
        };
        function setupPage(page) {
            $.ajax({
                url: page,
                data: { asPartial: 1 },
                success: function(response) {
                    $("#content").html(response);
                    //alert(response);
                }
            });
            return false;
        }
    </script>

</head>
<body>

    <div class="topbar">
        

        @if (ViewBag.UserDetails == null)
        {
            <div class="topitem userlink">
                Log In
                <div id="userbox" class="userbox">
                    @Ajax.ActionLink("Log in", "LoginTab", "Account", new AjaxOptions { InsertionMode = InsertionMode.Replace, UpdateTargetId = "userform" })
                    |
                    @Ajax.ActionLink("Register", "RegisterTab", "Account", new AjaxOptions { InsertionMode = InsertionMode.Replace, UpdateTargetId = "userform" })

                    <div id="userform">@Html.Partial("~/Views/Shared/Login.cshtml",new LoginModel())</div>
                </div>
            </div>
        }
        else
        {
            <div class="topitem userlink">
                @ViewBag.UserDetails.UserName
                <div id="userbox" class="userbox">
                    Wecome back, @ViewBag.UserDetails.UserName!

                    <div id="userform"></div>
                </div>
            </div>
            <div class="topitem">
                <a href="/Albums/MyAlbums" onclick="go('Albums', 'MyAlbums', ''); event.preventDefault();">My Albums</a>
            </div>
        }

    </div>



    <div id="message" class="alert" style="display:none;"></div>



    <div id="content">
        @RenderBody()
    </div>




    

    @Scripts.Render("~/bundles/jquery")
</body>
</html>
